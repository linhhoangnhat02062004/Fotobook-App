
  <!-- Modern Feeds Page -->
<div class="container-fluid py-3">
  <div class="row">
    <!-- Main Content -->
    <div class="col-lg-7 mx-auto">
      <!-- Page Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class = "mt-3">
          <h2 class="fw-bold text-dark mb-1">
            <i class="fas fa-home text-dark"></i> <span class = "text-dark" style = "font-size: 18.5pt;">Feeds</span>
          </h2>
          <% if user_signed_in? %>
            <p class="text-muted mb-0" style = "font-size: 10.5pt;">Discover amazing photos and albums from people you follow</p>
          <% else %>
            <p class="text-muted mb-0" style = "font-size: 10.5pt;">Discover amazing photos and albums from our community</p>
          <% end %>
        </div>
        
        <!-- Tab Navigation -->
        <div class="btn-group" role="group" aria-label="Feed tabs">
          <input type="radio" class="btn-check" name="feedType" id="photos" checked>
          <label class="btn btn-outline-primary" for="photos">
            <i class="fas fa-image custom-icons" ></i> <span style = "font-size: 10pt;">Photos</span>
          </label>
          
          <input type="radio" class="btn-check" name="feedType" id="albums">
          <label class="btn btn-outline-primary" for="albums">
            <i class="fas fa-images custom-icons"></i> <span style = "font-size: 10pt;">Albums</span>
          </label>
        </div>
      </div>

      <!-- Photos Feed -->
      <div id="photosFeed" class="feed-content">
        <% @photos.each do |photo| %>
          <div class="card mb-4 feed-card">
            <!-- Photo Header -->
            <div class="card-header bg-transparent border-0 pb-2">
              <div class="d-flex align-items-center">
                <div class="user-avatar me-3">
                  <% if photo.user.avatar.present? %>
                    <%= image_tag photo.user.avatar.url, 
                        class: 'rounded-circle', 
                        width: 50, 
                        height: 50,
                        style: 'object-fit: cover;' %>
                  <% else %>
                    <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center"
                         style="width: 50px; height: 50px; background: var(--primary-color);">
                      <i class="fas fa-user text-white"></i>
                    </div>
                  <% end %>
                </div>
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center">
                    <h6 class="fw-bold" style = "margin-bottom: 0.1pt;">
                      <%= link_to "#{photo.user.first_name} #{photo.user.last_name}", 
                          user_path(photo.user), 
                          class: 'text-decoration-none text-dark' %>
                    </h6>
                    <% if photo.sharing_mode == 'private' %>
                      <i class="fas fa-lock text-muted ms-2" title="Private"></i>
                    <% end %>
                  </div>
                  <small class="text-muted" style = "font-size: 9.5pt;">
                    <i class="fas fa-clock"></i>
                    <%= time_ago_in_words(photo.created_at) %> ago
                  </small>
                </div>
                <div class="dropdown">
                  <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-ellipsis-h"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="<%= photo_path(photo) %>">View Details</a></li>
                    <% if user_signed_in? && current_user == photo.user %>
                      <li><a class="dropdown-item" href="<%= edit_photo_path(photo) %>">Edit</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= link_to 'Delete', photo_path(photo), 
                            method: :delete, 
                            class: 'dropdown-item text-danger',
                            data: { confirm: 'Are you sure?' } %>
                      </li>
                    <% end %>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Photo Content -->
            <div class="card-body py-1">
              <div class="photo-container position-relative">
                <% if photo.image.present? %>
                  <%= image_tag photo.image.url, 
                      class: 'w-100', 
                      style: 'max-height: 600px; object-fit: cover;',
                      data: { 
                        bs_toggle: 'modal', 
                        bs_target: '#photoModal',
                        photo_id: photo.id 
                      } %>
                <% else %>
                  <div class="placeholder-image d-flex align-items-center justify-content-center"
                       style="height: 400px; background: #f8f9fa;">
                    <i class="fas fa-image fa-3x text-muted"></i>
                  </div>
                <% end %>
                
                <!-- Like Button Overlay -->
                <% if user_signed_in? %>
                  <div class="position-absolute top-0 end-0 m-3">
                    <% if current_user.liked?(photo) %>
                      <%= button_to unlike_photo_path(photo), method: :delete, class: 'btn btn-light btn-sm rounded-circle like-btn liked', style: 'width: 40px; height: 40px;' do %>
                        <i class="fas fa-heart text-danger"></i>
                      <% end %>
                    <% else %>
                      <%= button_to like_photo_path(photo), method: :post, class: 'btn btn-light btn-sm rounded-circle like-btn', style: 'width: 40px; height: 40px;' do %>
                        <i class="fas fa-heart text-muted"></i>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>

            <!-- Photo Footer -->
            <div class="card-footer bg-transparent border-0 pt-3">
              <h5 class="fw-bold mb-2"><%= photo.title %></h5>
              <p class="text-muted mb-3"><%= photo.description %></p>
              
              <!-- Interaction Stats -->
              <div class="d-flex align-items-center text-muted mb-2">
                <small class="me-4">
                  <i class="fas fa-heart me-0"></i>
                  <span class="like-count"><%= photo.likes.count %></span> likes
                </small>
                <small>
                  <i class="fas fa-comment me-0"></i>
                  <span>0</span> comments
                </small>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Albums Feed -->
      <div id="albumsFeed" class="feed-content" style="display: none;">
        <% @albums.each do |album| %>
          <div class="card mb-4 feed-card">
            <!-- Album Header -->
            <div class="card-header bg-transparent border-0 pb-0">
              <div class="d-flex align-items-center">
                <div class="user-avatar me-3">
                  <% if album.user.avatar.present? %>
                    <%= image_tag album.user.avatar.url, 
                        class: 'rounded-circle', 
                        width: 50, 
                        height: 50,
                        style: 'object-fit: cover;' %>
                  <% else %>
                    <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center"
                         style="width: 48px; height: 48px; background: var(--primary-color);">
                      <i class="fas fa-user text-white"></i>
                    </div>
                  <% end %>
                </div>
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center">
                    <h6 class="mb-0 fw-bold">
                      <%= link_to "#{album.user.first_name} #{album.user.last_name}", 
                          user_path(album.user), 
                          class: 'text-decoration-none text-dark' %>
                    </h6>
                    <% if album.sharing_mode == 'private' %>
                      <i class="fas fa-lock text-muted ms-2" title="Private"></i>
                    <% end %>
                  </div>
                  <small class="text-muted">
                    <i class="fas fa-clock me-1"></i>
                    <%= time_ago_in_words(album.created_at) %> ago
                  </small>
                </div>
                <div class="dropdown">
                  <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-ellipsis-h"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="<%= album_path(album) %>">View Album</a></li>
                    <% if user_signed_in? && current_user == album.user %>
                      <li><a class="dropdown-item" href="<%= edit_album_path(album) %>">Edit</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= link_to 'Delete', album_path(album), 
                            method: :delete, 
                            class: 'dropdown-item text-danger',
                            data: { confirm: 'Are you sure?' } %>
                      </li>
                    <% end %>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Album Content -->
            <div class="card-body p-2">
              <div class="album-preview position-relative">
                <% if album.photos.any? %>
                  <div class="row g-0">
                    <% album.photos.limit(4).each_with_index do |photo, index| %>
                      <div class="col-6">
                        <% if photo.image.present? %>
                          <%= image_tag photo.image.url, 
                              class: 'w-100', 
                              style: 'height: 550px; object-fit: cover;' %>
                        <% else %>
                          <div class="placeholder-image d-flex align-items-center justify-content-center"
                               style="height: 550px; background: #f8f9fa;">
                            <i class="fas fa-image text-muted"></i>
                          </div>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                  
                  <!-- Album Overlay -->
                  <div class="album-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
                       style="background: rgba(0,0,0,0.5);">
                    <div class="text-center text-white">
                      <h4 class="mb-2"><%= album.title %></h4>
                      <p class="mb-3"><%= album.description %></p>
                      <div class="d-flex align-items-center justify-content-center">
                        <span class="me-3">
                          <i class="fas fa-images me-1"></i>
                          <%= album.photos.count %> photos
                        </span>
                        <span>
                          <i class="fas fa-heart me-1"></i>
                          <span class="like-count">0</span> likes
                        </span>
                      </div>
                    </div>
                  </div>
                <% else %>
                  <div class="placeholder-album d-flex align-items-center justify-content-center"
                       style="height: 500px; background: #f8f9fa;">
                    <div class="text-center">
                      <i class="fas fa-images fa-3x text-muted mb-3"></i>
                      <p class="text-muted">No photos in this album</p>
                    </div>
                  </div>
                <% end %>
                
                <!-- Like Button Overlay -->
                <% if user_signed_in? %>
                  <div class="position-absolute top-0 end-0 m-3">
                    <% if current_user.liked?(album) %>
                      <%= button_to unlike_album_path(album), method: :delete, class: 'btn btn-light btn-sm rounded-circle like-btn liked', style: 'width: 40px; height: 40px;' do %>
                        <i class="fas fa-heart text-danger"></i>
                      <% end %>
                    <% else %>
                      <%= button_to like_album_path(album), method: :post, class: 'btn btn-light btn-sm rounded-circle like-btn', style: 'width: 40px; height: 40px;' do %>
                        <i class="fas fa-heart text-muted"></i>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>

            <!-- Album Footer -->
            <div class="card-footer bg-transparent border-0 pt-3">
              <h5 class="fw-bold mb-2"><%= album.title %></h5>
              <p class="text-muted mb-3"><%= album.description %></p>
              
              <!-- Interaction Stats -->
              <div class="d-flex align-items-center text-muted">
                <small class="me-3">
                  <i class="fas fa-images me-1"></i>
                  <%= album.photos.count %> photos
                </small>
                <small class="me-3">
                  <i class="fas fa-heart me-1"></i>
                  <span class="like-count"><%= album.likes.count %></span> likes
                </small>
                <small>
                  <i class="fas fa-comment me-1"></i>
                  <span>0</span> comments
                </small>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Empty State -->
      <% if @photos.empty? && @albums.empty? %>
        <div class="text-center py-5">
          <div class="empty-state">
            <i class="fas fa-camera fa-4x text-muted mb-4"></i>
            <h4 class="text-muted mb-3">No content to show</h4>
            <% if user_signed_in? %>
              <p class="text-muted mb-4">Start following people to see their photos and albums in your feed</p>
              <a href="<%= discovery_path %>" class="btn btn-primary">
                <i class="fas fa-compass me-2"></i>Discover People
              </a>
            <% else %>
              <p class="text-muted mb-4">Sign up to start following people and see their content</p>
              <a href="<%= new_user_registration_path %>" class="btn btn-primary">
                <i class="fas fa-user-plus me-2"></i>Sign Up
              </a>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Photo Modal -->
<div class="modal fade" id="photoModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <div id="modalPhotoContent"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const photosTab = document.getElementById('photos');
    const albumsTab = document.getElementById('albums');
    const photosFeed = document.getElementById('photosFeed');
    const albumsFeed = document.getElementById('albumsFeed');

    photosTab.addEventListener('change', function() {
      photosFeed.style.display = 'block';
      albumsFeed.style.display = 'none';
    });

    albumsTab.addEventListener('change', function() {
      albumsFeed.style.display = 'block';
      photosFeed.style.display = 'none';
    });

    // Like button handlers
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const photoId = this.dataset.photoId;
        const albumId = this.dataset.albumId;
        
        if (photoId) {
          // Handle photo like
          fetch(`/photos/${photoId}/like`, {
            method: 'POST',
            headers: {
              'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
              'Content-Type': 'application/json'
            }
          }).then(response => {
            if (response.ok) {
              this.classList.toggle('liked');
              const icon = this.querySelector('i');
              icon.classList.toggle('text-danger');
            }
          });
        } else if (albumId) {
          // Handle album like
          fetch(`/albums/${albumId}/like`, {
            method: 'POST',
            headers: {
              'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
              'Content-Type': 'application/json'
            }
          }).then(response => {
            if (response.ok) {
              this.classList.toggle('liked');
              const icon = this.querySelector('i');
              icon.classList.toggle('text-danger');
            }
          });
        }
      });
    });

    // Photo modal
    const photoModal = document.getElementById('photoModal');
    photoModal.addEventListener('show.bs.modal', function(event) {
      const button = event.relatedTarget;
      const photoId = button.dataset.photoId;
      
      // Load photo content into modal
      fetch(`/photos/${photoId}`)
        .then(response => response.text())
        .then(html => {
          document.getElementById('modalPhotoContent').innerHTML = html;
        });
    });
  });
</script>
