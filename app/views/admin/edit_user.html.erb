<% content_for :title, "Edit User - #{@user.full_name}" %>
<% content_for :layout, "admin" %>

<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="mb-2">
          <i class="fas fa-edit me-3 text-primary"></i>Edit User Profile
        </h1>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><%= link_to "Dashboard", admin_dashboard_path %></li>
            <li class="breadcrumb-item"><%= link_to "Users", admin_users_path %></li>
            <li class="breadcrumb-item"><%= link_to @user.full_name, admin_user_path(@user) %></li>
            <li class="breadcrumb-item active">Edit</li>
          </ol>
        </nav>
      </div>
      <div class="d-flex gap-2">
        <%= link_to "Back to User", admin_user_path(@user), class: "btn btn-outline-secondary" %>
        <%= link_to "View Public Profile", user_path(@user), class: "btn btn-primary", target: "_blank" %>
      </div>
    </div>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="admin-card">
      <div class="admin-card-header">
        <h5 class="admin-card-title">
          <i class="fas fa-user-edit me-2"></i>Edit User Information
        </h5>
      </div>
      <div class="admin-card-body">
        <%= form_with(model: @user, url: admin_update_user_path(@user), method: :patch, local: true, html: { multipart: true }) do |f| %>
          <!-- Avatar Section -->
          <div class="text-center mb-4">
            <div class="position-relative d-inline-block">
              <% if @user.avatar.present? %>
                <%= image_tag @user.avatar.url, width: 120, height: 120, class: "rounded-circle border border-3 border-white shadow mb-2", style: "object-fit: cover;" %>
              <% else %>
                <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2" style="width: 120px; height: 120px;">
                  <i class="fas fa-user fa-3x text-white"></i>
                </div>
              <% end %>
              <label for="user_avatar" class="btn btn-sm btn-secondary position-absolute bottom-0 start-50 translate-middle-x mb-1 px-3" style="border-radius: 20px; cursor: pointer;">
                <i class="fas fa-camera me-1"></i>Change
              </label>
              <%= f.file_field :avatar, accept: "image/jpeg,image/png", class: "d-none", id: "user_avatar" %>
            </div>
          </div>

          <!-- Basic Information -->
          <h5 class="fw-bold text-primary mb-3">
            <i class="fas fa-info-circle me-2"></i>Basic Information
          </h5>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <%= f.label :first_name, class: 'form-label fw-semibold' %>
              <%= f.text_field :first_name, required: true, class: 'form-control' %>
            </div>
            <div class="col-md-6">
              <%= f.label :last_name, class: 'form-label fw-semibold' %>
              <%= f.text_field :last_name, required: true, class: 'form-control' %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <%= f.label :email, class: 'form-label fw-semibold' %>
              <%= f.email_field :email, required: true, class: 'form-control' %>
            </div>
            <div class="col-md-6">
              <%= f.label :status, class: 'form-label fw-semibold' %>
              <%= f.select :status, [['Active', 'active'], ['Suspended', 'suspended']], {}, class: 'form-select' %>
            </div>
          </div>

          <!-- Password Section -->
          <h5 class="fw-bold text-primary mb-3 mt-4">
            <i class="fas fa-lock me-2"></i>Password (Optional)
          </h5>
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            Leave password fields blank if you don't want to change the password.
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <%= f.label :password, "New Password", class: 'form-label fw-semibold' %>
              <%= f.password_field :password, class: 'form-control' %>
            </div>
            <div class="col-md-6">
              <%= f.label :password_confirmation, class: 'form-label fw-semibold' %>
              <%= f.password_field :password_confirmation, class: 'form-control' %>
            </div>
          </div>

          <!-- Admin Role -->
          <h5 class="fw-bold text-primary mb-3 mt-4">
            <i class="fas fa-shield-alt me-2"></i>Role & Permissions
          </h5>
          
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="form-check">
                <%= f.check_box :admin, class: 'form-check-input' %>
                <%= f.label :admin, "Admin User", class: 'form-check-label fw-semibold' %>
              </div>
              <small class="text-muted">Grant admin privileges to this user</small>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex justify-content-between align-items-center pt-3 border-top">
            <div>
              <%= link_to "Cancel", admin_user_path(@user), class: "btn btn-outline-secondary" %>
            </div>
            <div class="d-flex gap-2">
              <%= f.submit "Update User", class: "btn btn-primary px-4 fw-bold" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Preview avatar when file is selected
  const avatarInput = document.getElementById('user_avatar');
  const avatarPreview = avatarInput.previousElementSibling;
  
  avatarInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        if (avatarPreview.tagName === 'IMG') {
          avatarPreview.src = e.target.result;
        } else {
          // Replace placeholder with image
          const img = document.createElement('img');
          img.src = e.target.result;
          img.width = 120;
          img.height = 120;
          img.className = 'rounded-circle border border-3 border-white shadow mb-2';
          img.style.objectFit = 'cover';
          avatarPreview.parentNode.replaceChild(img, avatarPreview);
        }
      };
      reader.readAsDataURL(file);
    }
  });
});
</script> 