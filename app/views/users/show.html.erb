<!-- app/views/users/show.html.erb -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fotobook - Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Facebook-style Font Stack (No external fonts needed) -->
  <%= stylesheet_link_tag 'application', media: 'all' %>
  <%= csrf_meta_tags %>
</head>
<body>
  <!-- Navigation -->
  <%= render 'shared/navigation' %>

<!-- Main Content -->
<div class="container-fluid mt-4">
  <div class="row">
    <!-- Left Sidebar -->
    <div class="col-lg-2 d-none d-lg-block">
      <div class="sidebar-nav">
        <div class="d-flex flex-column">
          <a href="<%= feeds_path %>" class="btn btn-light mb-3 text-start">
            <i class="fas fa-home me-2"></i>Feeds
          </a>
          <a href="<%= discover_path %>" class="btn btn-light text-start">
            <i class="fas fa-compass me-2"></i>Discover
          </a>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <div class="col-lg-10">
      <!-- Profile Header -->
      <div class="profile-header mb-4">
        <div class="d-flex align-items-start">
          <!-- Avatar -->
          <div class="me-4">
            <% if @user && @user.avatar.present? %>
              <%= image_tag @user.avatar.url, alt: 'User Avatar', class: 'rounded-circle profile-avatar', width: 120, height: 120, style: 'object-fit: cover;' %>
            <% else %>
              <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center text-white fw-bold profile-avatar" style="width: 120px; height: 120px; font-size: 2.5rem;">
                <%= @user.first_name.first.upcase %><%= @user.last_name.first.upcase %>
              </div>
            <% end %>
          </div>
          
          <!-- User Info -->
          <div class="flex-grow-1">
            <div class="d-flex align-items-center mb-3">
              <% if current_user == @user %>
                <a href="<%= edit_profile_path %>" class="btn btn-outline-primary btn-sm me-3">
                  <i class="fas fa-edit me-1"></i>Edit Profile
                </a>
              <% else %>
                <button class="btn btn-primary btn-sm me-3">
                  <i class="fas fa-user-plus me-1"></i>Follow
                </button>
              <% end %>
              <h2 class="mb-0"><%= @user.first_name %> <%= @user.last_name %></h2>
            </div>
            
            <!-- Stats -->
            <div class="profile-stats">
              <div class="d-flex align-items-center text-muted">
                <button class="btn btn-link text-decoration-none p-0 me-4 stats-btn active" data-content="photos" type="button">
                  <strong><%= @photos.count %></strong> 
                  <span class="text-uppercase">photos</span>
                </button>
                <button class="btn btn-link text-decoration-none p-0 me-4 stats-btn" data-content="albums" type="button">
                  <strong><%= @albums.count %></strong> 
                  <span class="text-uppercase">albums</span>
                </button>
                <button class="btn btn-link text-decoration-none p-0 me-4 stats-btn" data-content="followings" type="button">
                  <strong>22</strong> 
                  <span class="text-uppercase">followings</span>
                </button>
                <button class="btn btn-link text-decoration-none p-0 stats-btn" data-content="followers" type="button">
                  <strong>13</strong> 
                  <span class="text-uppercase">followers</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Add Photo Button -->
          <div class="ms-auto">
            <a href="<%= new_photo_path %>" class="btn btn-success btn-sm">
              <i class="fas fa-plus me-1"></i>Add Photo
            </a>
          </div>
        </div>
      </div>

      <!-- Content Sections -->
      <!-- Photos Section -->
      <div id="photos-content" class="content-section">
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
          <% @photos.each do |photo| %>
            <div class="col">
              <div class="card border-0 shadow-sm position-relative photo-card">
                <% if photo.image.present? %>
                  <%= image_tag photo.image.url, class: 'card-img-top', alt: photo.title, style: 'height: 200px; object-fit: cover;' %>
                <% else %>
                  <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                    <i class="fas fa-image fa-3x text-muted"></i>
                  </div>
                <% end %>
                
                <!-- Privacy indicator -->
                <div class="position-absolute top-0 end-0 m-2">
                  <% if photo.sharing_mode == 'private' %>
                    <i class="fas fa-lock text-white bg-dark bg-opacity-50 rounded-circle p-1" style="font-size: 12px;"></i>
                  <% else %>
                    <i class="fas fa-globe text-white bg-dark bg-opacity-50 rounded-circle p-1" style="font-size: 12px;"></i>
                  <% end %>
                </div>
                
                <!-- Edit button overlay -->
                <div class="position-absolute bottom-0 end-0 m-2">
                  <a href="<%= edit_photo_path(photo) %>" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-edit"></i>
                  </a>
                </div>
                
                <div class="card-body p-2">
                  <p class="card-text small text-muted mb-0"><%= photo.title %></p>
                </div>
              </div>
            </div>
          <% end %>
          
          <% if @photos.empty? %>
            <div class="col-12">
              <div class="empty-state-container text-center py-5">
                <div class="empty-state-icon mb-4">
                  <div class="camera-icon-wrapper">
                    <i class="fas fa-camera"></i>
                  </div>
                </div>
                <div class="empty-state-content">
                  <h4 class="empty-state-title mb-3">Chưa có ảnh nào</h4>
                  <p class="empty-state-description mb-4">Bắt đầu chia sẻ những khoảnh khắc đẹp của bạn với thế giới!</p>
                  <a href="<%= new_photo_path %>" class="btn btn-primary btn-lg upload-btn">
                    <i class="fas fa-cloud-upload-alt me-2"></i>Tải ảnh lên
                  </a>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Albums Section -->
      <div id="albums-content" class="content-section" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">My Albums</h4>
          <a href="<%= new_album_path %>" class="btn btn-primary btn-sm">
            <i class="fas fa-plus me-1"></i>Add Album
          </a>
        </div>
        
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
          <% @albums.each do |album| %>
            <div class="col">
              <div class="card border-0 shadow-sm position-relative album-card">
                <% if album.cover_photo&.image.present? %>
                  <%= image_tag album.cover_photo.image.url, class: 'card-img-top', alt: album.title, style: 'height: 200px; object-fit: cover;' %>
                <% else %>
                  <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                    <i class="fas fa-images fa-3x text-muted"></i>
                  </div>
                <% end %>
                
                <!-- Privacy indicator -->
                <div class="position-absolute top-0 end-0 m-2">
                  <% if album.sharing_mode == 'private' %>
                    <i class="fas fa-lock text-white bg-dark bg-opacity-50 rounded-circle p-1" style="font-size: 12px;"></i>
                  <% else %>
                    <i class="fas fa-globe text-white bg-dark bg-opacity-50 rounded-circle p-1" style="font-size: 12px;"></i>
                  <% end %>
                </div>
                
                <!-- Photo count overlay -->
                <div class="position-absolute top-50 start-50 translate-middle text-center">
                  <div class="bg-white rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                    <div>
                      <div class="fw-bold text-dark"><%= album.photo_count %></div>
                      <div class="small text-muted">PHOTOS</div>
                    </div>
                  </div>
                </div>
                
                <!-- Edit button overlay -->
                <div class="position-absolute bottom-0 end-0 m-2">
                  <a href="<%= edit_album_path(album) %>" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-edit"></i>
                  </a>
                </div>
                
                <div class="card-body p-2">
                  <p class="card-text small text-muted mb-0"><%= album.title %></p>
                </div>
              </div>
            </div>
          <% end %>
          
          <% if @albums.empty? %>
            <div class="col-12 text-center py-5">
              <i class="fas fa-images fa-3x text-muted mb-3"></i>
              <h5 class="text-muted">No albums yet</h5>
              <p class="text-muted">Create your first album to start organizing your photos!</p>
              <a href="<%= new_album_path %>" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Create Album
              </a>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Followings Section -->
      <div id="followings-content" class="content-section" style="display: none;">
        <h4 class="mb-3">My Followings</h4>
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
          <% 22.times do |i| %>
            <div class="col">
              <div class="card border-0 shadow-sm">
                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                  <i class="fas fa-user fa-3x text-muted"></i>
                </div>
                <div class="card-body p-2">
                  <p class="card-text small text-muted mb-0">Following User <%= i + 1 %></p>
                  <button class="btn btn-outline-danger btn-sm mt-2">
                    <i class="fas fa-user-minus me-1"></i>Unfollow
                  </button>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Followers Section -->
      <div id="followers-content" class="content-section" style="display: none;">
        <h4 class="mb-3">My Followers</h4>
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
          <% 13.times do |i| %>
            <div class="col">
              <div class="card border-0 shadow-sm">
                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                  <i class="fas fa-user fa-3x text-muted"></i>
                </div>
                <div class="card-body p-2">
                  <p class="card-text small text-muted mb-0">Follower User <%= i + 1 %></p>
                  <button class="btn btn-outline-primary btn-sm mt-2">
                    <i class="fas fa-user-plus me-1"></i>Follow Back
                  </button>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <%= javascript_include_tag 'application' %>
  
  <script>
    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', function() {
      const statsBtns = document.querySelectorAll('.stats-btn');
      const contentSections = document.querySelectorAll('.content-section');
      
      statsBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const contentType = this.getAttribute('data-content');
          
          // Remove active class from all buttons
          statsBtns.forEach(b => b.classList.remove('active'));
          // Add active class to clicked button
          this.classList.add('active');
          
          // Hide all content sections
          contentSections.forEach(section => {
            section.style.display = 'none';
          });
          
          // Show selected content section
          const targetSection = document.getElementById(contentType + '-content');
          if (targetSection) {
            targetSection.style.display = 'block';
          }
        });
      });
    });
    
    // Album view functionality
    function viewAlbum(albumId) {
      // Navigate to album detail page
      window.location.href = '/albums/' + albumId;
    }
    
    // Photo view functionality
    function viewPhoto(photoId) {
      // Navigate to photo detail page
      window.location.href = '/photos/' + photoId;
    }
  </script>
</body>
</html>
